# Express js

Итак создаем пустую папку под наш проект. Первое, что необходимо сделать, это создать файл package.json. Это файл, в котором мы храним список установленных пакетов и их версии. Когда вы захотите развернуть ваш проект на новой машине или дать проект другому девелоперу, одной команды npm install будет достаточно, чтобы установить все зависимости, которые необходимы для проекта.

Для создания файла package.json автоматически напишем

```
npm init -y
```

Если мы откроем файл package.json, то он практически пустой. В нем указан автор, версия и другая общая информация.

Теперь давайте установим express

```
npm i express -S
```

Эта команда установила нам express и все его зависимости. Аргумент -S, чтобы пакет был добавлен в package.json.

Также в проекте у нас создалась директория node_modules. Это папка, где хранятся все библиотеки установленные с помощью npm.

Теперь давайте создадим файл index.js, который будет нашим сервером.
Для начала нам нужно подключить библиотеку express. Делается это с помощью слова require. В данном случае оно подключит пакет express из папки node_modules.

```
const express = require('express');
```

Дальше нам необходимо создать переменную app, которая и будет являтся нашим сервером.

const app = express();

```
Теперь мы обьявить роут для нашего приложения. Описывая роут, мы описываем, что будет происходить, когда мы зайдем на определенный урл.
```

app.get('/', function (req, res) {
res.send('Hello API');
});

```
Здесь мы описали, что мы хотим описать роут /, и когда мы будем на него заходить, то нам на странице будет выводиться Hello API. req - это request, а res - это response. И мы вызываем функцию send, чтобы закончить ответ и вывести строку на екран.
Теперь нам нужно настроить сервер, чтобы он был запущен на определенном порту. Для этого добавим
```

app.listen(3000, ()=> {
console.log('API app started')
})

```
Это запустит сервер на 300 порту и когда он запустится выведет в консоль console.log.
Теперь если мы в консоли напишем nodemon index.js, или npm start, если мы прописали соответствующую дерективу в package.json, то у нас запустится сервер и выведется в консоль API app started.
Теперь если мы откроем в браузере http://localhost:3000, то у нас выведется на страницу Hello API.

Мы с вами будем делать API музыкантов. И уже сейчас мы можем добавить роут, который будет возвращать нам список исполнителей.

Давайте создадим массив исполнителей, который пока будет статическим и опишем роут /artists для него.

Артистов мы будем хранить как массив обьектов с ID и названиями.

var artists = [
{
id: 1,
name: 'Mozart'
},
{
id: 2,
name: 'Shopen'
},
{
id: 3,
name: 'Bax'
}
];
и добавим роут
```

app.get('/artists', function (req, res) {
res.send(artists);
});

```
в котором отдадим описаных исполнителей.
Если мы зайдем на http://localhost:3012/artists, то увидим что у нас отрендерился спсок исполнителе.

Теперь давайте опишем роут, который будет возвращать отдельного исполнителя. Для того, чтобы описать урл вида /artists/1 нам необходимо вместо 1 задать динамический параметр.

```

app.get('/artists/:id', function (req, res) {
var artist = artists.find(function (artist) {
return artist.id === Number(req.params.id);
})
console.log(artist);
res.send(artist);
});

```
Что бы мы не писали вместо id, у нас всегда будет срабатывать этот обработчик. Получить значение динамического id можно из req.params, где содержатся все параметры.
И найдем необходимого исполнителя в массиве, использовали обычный find из javascript, чтобы найти обьект в массиве. Единственный нюанс в том, что все параметры из урла являются строками. А наши ID это Number. Поэтому мы приводим req.params.id к Number.

```

Для добавления данных в наш API мы будем использовать POST запрос. Так как данные POST запроса передаются в body, то нам необходимо подключить функции, которые будут парсить наше тело запроса и в req.body записывать что мы передали

и сразу после строчки создания сервера добавим

```
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
```

Первая строчка нам нужна, чтобы парсить json, а вторая, чтобы парсить данные формы.

Теперь давайте напишем обработчик нашего запроса

```
app.post('/artists', function (req, res) {
console.log(req.body);
res.send('post data');
})
```

В этот раз мы описали POST, а не GET. Мы добавили req.body и вернули тестовую строку.

Как же нам отправить POST запрос? Используеться Postman. Это плагин, который позволяет отправлять запросы.

Указываем урл http://localhost:3000/artists и выбираем тип запроса POST. Дальше кликаем на body и выбираем raw. Здесь нам необходимо указать валидный JSON.

```
{"aaa": "111"}
```

Теперь если мы кликнем Send, то мы видим ответ "post data" от нашего сервера. В консоли же у нас вывелось req.body. Как мы видим, это обычный JSON. Именно такой JSON мы ожидаем получать от фронтенда, чтобы добавлять новых исполнителей.

В нашем случае нам достаточно передавать поле name. Так как базу данных мы пока не используем, то мы будем просто добавлять данные в наш статический массив. Нужно понимать, что во время того, как сервер запущен, эти данные хранятся в оперативной памяти. И как только мы остановим сервер они сотрутся. Но в данным момент нам этого достаточно.

```
app.post('/artists', function (req, res) {
var artist = {
id: Date.now(),
name: req.body.name
}
artists.push(artist);
res.send(artist);
})
```

Мы создаем нового артиста. У него мы указываем id, который мы берем используя текущую дану. В нашем случае это даст нам уникальный id, но когда мы будем использовать позже базу данных у нас будут автоматически генерироваться нормальные id. Мы добавляем нового артиста в массив и в качестве ответа возвращаем добавленного артиста.

Теперь реализуем обновление данных. Мы хотим, менять у исполнителя только name, а id всегда оставался одинаковый.

```
app.put('/artists/:id', function (req, res) {
var artist = artists.find(function (artist) {
return artist.id === Number(req.params.id)
});
artist.name = req.body.name;
res.send(artist);
})
```

Описываем put, где указываем динамический id, который хотим обновить и внутри находим исполнителя по id из параметров. Дальше меняем у него имя на имя, полученное из боди запроса. Так как переменная artist является ссылкой на елемент массива, то меняя этот обьект, мы меняем его в массиве. И возвращаем обновленные данные.

Вместо

```
res.send(artist);
```

Мы можем писать

```
res.sendStatus(200);
```

Это вернет нам статус 200 и сообщение Ok. Обновленные данные возвращать не обязательно, так как мы и так знаем, какие данные мы обновляли и нам главное, чтобы сервер подтвердил, что все хорошо и данные обновлены.

Если мы выполним put запрос и потом получим список исполнителей, то увидим, что он обновился.

Нам осталось реализовать в API только удаление.

Для этого давайте добавим delete метод.

```
app.delete('/artists/:id', function (req, res) {
artists = artists.filter(function (artist) {
return artist.id !== Number(req.params.id)
})
res.sendStatus(200);
})
```

Мы хотим пересохранить массив artists отфильтровав всех артистов, кроме того, какой хотим удалить. Это вернет нам массив без удаляемого елемента. Главное опять не забыть привести ID к Number. И конечно мы возвращаем статус 200, который говорит, что удаление прошло успешно.

Если мы выполним delete запрос и получим список исполнителей, то увидим, что мы его удалили.
